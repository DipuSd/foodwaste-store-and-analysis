<%- include('partial/header.ejs') %>

<div class="container mt-5">
  <div class="row">
  <!-- The form for contributing food waste data -->
  <form action="/food-waste-data" method="post">
    <div class="container mt-5">
      <h2 class="mb-4">Food Waste Data Form</h2>

      <form action="/food-waste-data" method="post">
        <div class="form-group">
          <label for="sourceName">Source Name:</label>
          <input
            type="text"
            class="form-control"
            id="sourceName"
            name="sourceName"
            required
          />
        </div>
        <div class="form-group">
          <label for="countryID">Country</label>
          <br>
          <select name="countryID" id="countryID">
            <option value="" selected disabled>Select One</option>

            <% locals.countries.map(country => { %>
              <option value="<%= country.countryID %>"> <%= country.countryName %></option>
              <% }) %>
          </select>
        </div>

        <div class="form-group">
          <label for="cityID">City</label>
          <br>
          <select name="cityID", id="cityID">
            <option value="" selected disabled>Select One</option>
          </select>
        </div>

        <div class="form-group">
          <label for="reason">Reason:</label>
          <textarea
            class="form-control"
            id="reason"
            name="reason"
            rows="3"
            required
          ></textarea>
        </div>

        <div class="form-group">
          <label for="quantity">Quantity:</label>
          <input
            type="number"
            class="form-control"
            id="quantity"
            name="quantity"
            required
          />
        </div>

        <div class="form-group">
          <label for="wasteGenerationDate">Waste Generation Date:</label>
          <input
            type="date"
            class="form-control"
            id="wasteGenerationDate"
            name="wasteGenerationDate"
            required
          />
        </div>

        <!-- Contribution Time (System Time) will be handled server-side -->

        <!-- Contribution Date (System Date) will be handled server-side -->

        <div class="form-group">
          <label for="foodWasteCategory"
            >Food Waste Category (comma-separated):</label
          >
          <input
            type="text"
            class="form-control"
            id="foodWasteCategory"
            name="foodWasteCategory"
            required
          />
          <small class="form-text text-muted"
            >Enter multiple categories separated by commas (e.g., Fruits,
            Vegetables).</small
          >
        </div>

        <button type="submit" class="btn btn-primary">Submit</button>
      </form>
    </div>
  </form>
</div>

<style>
  .scrollable-table {
    max-height: 400px;
    overflow-y: auto;
  }

  .table-container {
    max-height: 100%;
  }
</style>

<script>
  $('select[name=countryID]').on('change', function() {
    const selectedCountryID = $(this).find(":selected").val();
    populateCitySelect(selectedCountryID)
}); 


  const populateCitySelect = (selectedCountryID) => {
    if (selectedCountryID) {
      fetch(`/api/cities?countryID=${selectedCountryID}`)
      .then(res => res.json())
      .then(data => {
        data.map(city => {
          $('select[name=cityID]').append(`<option value="${city.cityID}">${city.cityName}</option>`)
        })
      })
    }
  }

</script>

<%- include('partial/footer.ejs') %>
